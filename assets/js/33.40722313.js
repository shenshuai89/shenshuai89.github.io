(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{345:function(s,t,e){"use strict";e.r(t);var a=e(7),r=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("原文链接："),t("a",{attrs:{href:"https://nextjs.org/learn/dashboard-app/setting-up-your-database",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://nextjs.org/learn/dashboard-app/setting-up-your-database"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("在您可以继续使用 dashboard 之前，你需要一些数据。\n在本章中，您将使用"),t("code",[s._v("@vercel/postgres")]),s._v("设置PostgreSQL数据库。如果你已经熟悉PostgreSQL，并且更喜欢使用自己的数据库，你可以跳过这一章，自己设置。否则，让我们继续！")]),s._v(" "),t("h2",{attrs:{id:"本章目标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本章目标"}},[s._v("#")]),s._v(" 本章目标")]),s._v(" "),t("ul",[t("li",[s._v("推送项目代码到github")]),s._v(" "),t("li",[s._v("建立一个Vercel帐户并链接您的GitHub回购以进行即时预览和部署。")]),s._v(" "),t("li",[s._v("创建项目并将其链接到Postgres数据库。")]),s._v(" "),t("li",[s._v("使用seedjs为数据库设定数据。")])]),s._v(" "),t("h2",{attrs:{id:"创建github存储库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建github存储库"}},[s._v("#")]),s._v(" 创建GitHub存储库")]),s._v(" "),t("p",[s._v("首先，让我们将您的存储库推送到Github（如果您还没有这样做的话）。这将使您的数据库设置和部署更加容易。\n如果您需要帮助设置存储库，请参阅GitHub上的"),t("a",{attrs:{href:"https://docs.github.com/en/repositories/creating-and-managing-repositories/quickstart-for-repositories",target:"_blank",rel:"noopener noreferrer"}},[s._v("此指南"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("h2",{attrs:{id:"创建vercel帐户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建vercel帐户"}},[s._v("#")]),s._v(" 创建Vercel帐户")]),s._v(" "),t("p",[s._v("访问"),t("a",{attrs:{href:"https://vercel.com/signup",target:"_blank",rel:"noopener noreferrer"}},[s._v("vercel.com/signup"),t("OutboundLink")],1),s._v("创建帐户。选择免费的“hobby”计划。选择继续使用GitHub连接您的GitHub和Vercel帐户。")]),s._v(" "),t("h2",{attrs:{id:"连接并部署您的项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#连接并部署您的项目"}},[s._v("#")]),s._v(" 连接并部署您的项目")]),s._v(" "),t("p",[s._v("接下来，您将进入这个屏幕，在那里您可以选择并导入刚刚创建的GitHub存储库：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/images/nextjs/06-1image.png",alt:"image.png"}}),s._v("\n命名您的项目，然后单击“部署”。\n"),t("img",{attrs:{src:"/assets/images/nextjs/06-2image.png",alt:"image.png"}}),s._v("\n好极了🎉 现在已部署您的项目。\n"),t("img",{attrs:{src:"/assets/images/nextjs/06-3image.png",alt:"image.png"}}),s._v("\n通过连接您的GitHub存储库，每当您将更改推送到主分支时，Vercel将自动重新部署您的应用程序，无需任何配置。打开拉取请求时，您还可以进行即时预览，以便尽早发现部署错误，并与团队成员共享项目预览以获得反馈。")]),s._v(" "),t("h2",{attrs:{id:"创建postgres数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建postgres数据库"}},[s._v("#")]),s._v(" 创建Postgres数据库")]),s._v(" "),t("p",[s._v("接下来，要设置数据库，请单击“"),t("code",[s._v("**Continue to Dashboard**")]),s._v("”，然后从项目面板中选择“"),t("strong",[s._v("Storage")]),s._v("”选项卡。选择"),t("strong",[s._v("Connect Store")]),s._v(" → "),t("strong",[s._v("Create New")]),s._v(" → "),t("strong",[s._v("Postgres")]),s._v(" → "),t("strong",[s._v("Continue")]),s._v(".\n"),t("img",{attrs:{src:"/assets/images/nextjs/06-4image.png",alt:"image.png"}}),s._v("\n接受条款，为数据库指定名称；并确保您的数据库区域设置为Washington D.C（iad1）-这也是所有新Vercel项目的默认区域。\n通过将数据库放置在同一区域或靠近应用程序代码【这里可以选择一个亚洲的】，可以减少数据请求的延迟。\n"),t("img",{attrs:{src:"/assets/images/nextjs/06-5image.png",alt:"image.png"}})]),s._v(" "),t("blockquote",[t("p",[s._v("特别提示：一旦数据库区域初始化，就不能更改它。如果您希望使用不同的区域，则应在创建数据库之前进行设置。")])]),s._v(" "),t("p",[s._v("连接后，导航到"),t("code",[s._v(".env.local")]),s._v("tab，点击"),t("code",[s._v("**Show secret**")]),t("strong",[s._v("和")]),t("code",[s._v("**Copy Snippet**")]),t("strong",[s._v("，复制出来")]),s._v(" "),t("img",{attrs:{src:"/assets/images/nextjs/06-6image.png",alt:"image.png"}}),s._v("\n导航到代码编辑器并重命名文件 "),t("code",[s._v(".env.example")]),s._v("为"),t("code",[s._v(".env")]),s._v("，粘贴从Vercel复制的数据库密码内容。")]),s._v(" "),t("blockquote",[t("p",[s._v("重要的提示：\n查看"),t("code",[s._v(".gitignore")]),s._v("文件确保已经添加了"),t("code",[s._v(".env")]),s._v("的配置，这个就避免将密码配置文件上传到github。")])]),s._v(" "),t("p",[s._v("最后，在您的终端中运行"),t("code",[s._v("pnpm i @vercel/postgres")]),s._v("来安装 "),t("code",[s._v("[Vercel Postgres SDK](https://vercel.com/docs/storage/vercel-postgres/sdk).")])]),s._v(" "),t("h2",{attrs:{id:"初始化数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化数据库"}},[s._v("#")]),s._v(" 初始化数据库")]),s._v(" "),t("p",[s._v("现在您的数据库已经创建，让我们使用一些初始数据对其进行最初设置。这将创建您在构建仪表板时使用一些数据。\n在项目的"),t("code",[s._v("/scripts")]),s._v("文件夹中，有一个名为"),t("code",[s._v("seed.js")]),s._v("的文件。此脚本包含创建和设定最初数据的说明"),t("code",[s._v("invoices")]),s._v("、"),t("code",[s._v("customers")]),s._v("、"),t("code",[s._v("user")]),s._v("、"),t("code",[s._v("revenue")]),s._v("表。\n如果您不了解代码所做的一切，请不要担心，但要给您一个概述。该脚本使用SQL创建表，并在创建表后使用"),t("code",[s._v("placeholder-data.js")]),s._v("文件中的数据填充表。\n接下来，在您的package.json文件中，将seed行添加到脚本中：")]),s._v(" "),t("div",{staticClass:"language-tsx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-tsx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"scripts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"build"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"next build"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"dev"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"next dev"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"start"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"next start"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"seed"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node -r dotenv/config ./scripts/seed.js"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("这是将执行"),t("code",[s._v("seed.js")]),s._v("的命令。\n现在，运行"),t("code",[s._v("pnpm seed")]),s._v("。您应该在终端中看到一些"),t("code",[s._v("console.log")]),s._v("日志消息，让您知道脚本正在运行。")]),s._v(" "),t("h2",{attrs:{id:"浏览数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#浏览数据库"}},[s._v("#")]),s._v(" 浏览数据库")]),s._v(" "),t("p",[s._v("让我们看看您的数据库是什么样子的。返回到Vercel，然后单击侧导航上的数据。\n在本节中，您将找到四个新表：users, customers, invoices, and revenue。\n"),t("img",{attrs:{src:"/assets/images/nextjs/06-7image.png",alt:"image.png"}}),s._v("\n通过选择每个表，您可以查看其记录，并确保条目与"),t("code",[s._v("placeholder-data.js")]),s._v("文件中的数据对齐。")]),s._v(" "),t("h2",{attrs:{id:"执行查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行查询"}},[s._v("#")]),s._v(" 执行查询")]),s._v(" "),t("p",[s._v("您可以切换到“查询”选项卡以与数据库交互。本节支持标准SQL命令。\n例如输入"),t("code",[s._v("DROP TABLE customers")]),s._v("将删除“客户”表及其所有数据，所以要**"),t("em",[s._v("小心")]),s._v("**！\n让我们运行您的第一个数据库查询。将以下SQL代码粘贴并运行到Vercel接口中：")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" invoices"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("amount"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" customers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" invoices\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" customers "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" invoices"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("customer_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" customers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" invoices"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("amount "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])])}),[],!1,null,null,null);t.default=r.exports}}]);